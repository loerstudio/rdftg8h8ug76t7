<!DOCTYPE html>
<html lang="en"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>AI Food Scan</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
<!-- Supabase and Auth Scripts -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="./js/supabaseClient.js"></script>
<script src="./js/auth.js"></script>
<script src="./js/api.js"></script>
<style type="text/tailwindcss">
        :root {
            --primary-color: #EF4444;
            --background-color: #000000;
            --surface-color: #1A1A1A;
            --text-primary: #FFFFFF;
            --text-secondary: #A3A3A3;
            --accent-color: #332929;
            --success-color: #4CAF50;
        }
        body {
            background-color: var(--background-color);
            color: var(--text-primary);
            font-family: 'Helvetica Neue', sans-serif;
        }
    </style>
  </head>
<body class="bg-black text-white">
<!-- Background page content (scan page) -->
<div class="flex flex-col h-screen">
    <header class="p-4 flex justify-between items-center">
        <button class="text-white" onclick="window.location.href='pagina-foodscanai-cliente.html'"><span class="material-icons text-3xl">close</span></button>
        <button class="text-white"><span class="material-icons text-3xl">help_outline</span></button>
    </header>
    <main class="flex-grow flex flex-col items-center justify-center p-4 text-center">
        <h1 class="text-2xl font-bold mb-2">Scan your food</h1>
        <div class="w-full aspect-square bg-gray-800 rounded-3xl flex items-center justify-center mb-8 relative overflow-hidden">
            <div class="absolute top-0 left-0 w-12 h-12 border-t-4 border-l-4 border-[var(--success-color)] rounded-tl-2xl"></div>
            <div class="absolute top-0 right-0 w-12 h-12 border-t-4 border-r-4 border-[var(--success-color)] rounded-tr-2xl"></div>
            <div class="absolute bottom-0 left-0 w-12 h-12 border-b-4 border-l-4 border-[var(--success-color)] rounded-bl-2xl"></div>
            <div class="absolute bottom-0 right-0 w-12 h-12 border-b-4 border-r-4 border-[var(--success-color)] rounded-br-2xl"></div>
        </div>
    </main>
</div>

<!-- Result Panel Overlay -->
<div class="absolute inset-0 bg-black bg-opacity-75 flex flex-col justify-end items-center z-20">
    <div class="bg-[var(--surface-color)] rounded-t-3xl p-6 w-full max-w-md text-left">
        <div class="w-12 h-1.5 bg-gray-600 rounded-full mx-auto mb-6"></div>
        <div class="flex items-center mb-4">
            <div class="bg-green-200 p-3 rounded-full inline-flex items-center justify-center mr-4">
                <span class="material-icons text-[var(--success-color)] text-3xl">check_circle</span>
            </div>
            <div>
                <h2 class="text-xl font-bold">Analisi Completata!</h2>
                <p class="text-[var(--text-secondary)]">Ecco la stima nutrizionale.</p>
            </div>
        </div>
        <div class="bg-[var(--accent-color)] rounded-2xl p-4 mb-6">
            <div class="flex items-center justify-between text-[var(--text-secondary)] text-sm mb-4">
                <span>Stima per il pasto</span>
                <span id="calories" class="text-[var(--primary-color)] font-semibold">-- kcal</span>
            </div>
            <div class="grid grid-cols-3 gap-4 text-center">
                <div>
                    <p id="carbs" class="font-semibold text-white">-- g</p>
                    <p class="text-xs text-[var(--text-secondary)]">Carboidrati</p>
                </div>
                <div>
                    <p id="protein" class="font-semibold text-white">-- g</p>
                    <p class="text-xs text-[var(--text-secondary)]">Proteine</p>
                </div>
                <div>
                    <p id="fat" class="font-semibold text-white">-- g</p>
                    <p class="text-xs text-[var(--text-secondary)]">Grassi</p>
                </div>
            </div>
        </div>
        <div class="flex flex-col space-y-4">
            <button class="bg-[var(--primary-color)] text-white font-bold py-4 rounded-xl">Aggiungi al Diario</button>
            <button id="scan-again-button" class="bg-transparent border border-[var(--text-secondary)] text-[var(--text-secondary)] font-bold py-4 rounded-xl">Scansiona un altro</button>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const resultString = localStorage.getItem('foodScanResult');
        if (resultString) {
            try {
                const result = JSON.parse(resultString);
                document.getElementById('calories').textContent = `${Math.round(result.calories_kcal) || '--'} kcal`;
                document.getElementById('carbs').textContent = `${Math.round(result.carb_g) || '--'} g`;
                document.getElementById('protein').textContent = `${Math.round(result.protein_g) || '--'} g`;
                document.getElementById('fat').textContent = `${Math.round(result.fat_g) || '--'} g`;
            } catch (e) {
                console.error('Failed to parse food scan result', e);
                document.getElementById('calories').textContent = 'Errore';
            }
            // Clear the item so it's not shown again on page refresh
            localStorage.removeItem('foodScanResult');
        } else {
             document.getElementById('calories').textContent = 'Nessun risultato';
        }

        document.getElementById('scan-again-button').addEventListener('click', () => {
            window.location.href = 'pagina-foodscanai-cliente.html';
        });
    });
</script>

</body></html>
